##### Сайберфизикс
#### Архитектурная задача ([Решение](/docs/ai_hw_monitor.md))
- Команда разработчиков придумала разработать сервис бизнес логики, который позволяет конфигурировать и реализовывать любые бизнес процессы. Процессы могу принимать как бинарное состояние (не выполнен – выполнен), так и иметь различные сценарии (не выполнен – подтвержден – отклонен)
- Например, можно представить бизнес логику простой задачи из пяти процессов, которая определят логику работы компании с дефектами оборудования, предсказанными системой предиктивной аналитики.
- Система может предсказать два критерия. Если оба критерия отрабатывают, они приходят оператору, который смотрит на данные и либо подтверждает, либо не подтверждает работу системы. Если не подтверждает, то задача идет инженеру, которые изменяет критерии, если подтверждает, то технологу, которые работает производит ремонт.
- Требования к системе:
  1. Система должна обрабатывать произвольные комбинации процессов и разлиынх модулей (модуль принятия решения, модуль критериев, модуль отправки почты и тд)
  1. Система должны иметь высокую пропускную способность и масштабируемость (от 1000 задач в секунду, поддержка 100000 процессов на одной ноде)
  1. Система должна быть настраиваемая и конфигурируемая, то есть иметь API по созданию процессов, их объединения и настройке (например, кому на почту приходят уведосления)

#### Задача на event сервис ([Пример](/src/task.py))
- Команда разработчиков придумала разработать сервис обработки событий/команд на RabbitMQ, который имеет API похожый на backend для удобства разработки (те для каждого метода можно определять callback с путем,  path параметрами и body).
- Каждый queue/topic определяет в себе scope задач. Ниже представлен пример двух сервисов, реализующих разный scope. Масштабирование происходит внутри одного scope по отдельности.
##### Требования
1. Оболочка сервиса должна быть в виде класса (максимальная близость к webapi фреймворкам)
1. Сервис должен реализовывать обычный вызов методов при появлении события/команды
* (со взездочкой) результат работы сервиса должен отправляться в топик
##### Задачи
1. Описать класс, позволяющий реализовать такую задачу (главное концепция, а не работоспособность)

#### Решение задачи на event сервис
##### Запуск в контейнерах
```bash
    docker-compose up -d
```
##### Просмотр логов в контейнерах
```bash
    docker-compose logs -f
```
##### Отправка сообщений в тестовую очередь
- по умолчанию пробрасывается порт 5672 на локальную машину
- реализован скрипт с захардкоженными настройками на guest:guest@localhost:5672
```bash
    git clone git@github.com:aarekuha/sf.git
    cd sf

    docker-compose up -d  # Если сервис еще не запущен в контейнере

    python -m venv venv
    source ./venv/bin/activate
    pip install -U pip
    pip install -r app/requirements.txt
    # отправка сообщения с заголовком route=another_method, one="any string", more="another string"
    python app/send.py
    # отправка сообщения с заголовками route=train_model, model_id=17 и body="текст сообщения"
    python app/send.py "текст сообщения"
```
